// ==================================================
// 
// jquery-input-mask-phone-number 1.0.14
//
// Licensed (The MIT License)
// 
// Copyright Â© Raja Rama Mohan Thavalam <rajaram.tavalam@gmail.com>
//
// Last Updated On: 22/Aug/2020 IST  12:05 AM 
//
// ==================================================

(function ($) {
    $.fn.usPhoneFormat = function (options) {
        var params = $.extend({
            format: 'xxx-xxx-xxxx',
            international: false,

        }, options);

        if (params.format === '(xxx) xxx-xxxx') {
            $(this).on('keydown touchend', function (e) {

                e = e || window.event;
                var key = e.which || e.keyCode; // keyCode detection
                var ctrl = e.ctrlKey ? e.ctrlKey : ((key === 17) ? true : false); // ctrl detection
                if (key == 86 && ctrl) { // Ctrl + V Pressed !
                	console.log('Ctrl + V Pressed !');
                } else if (key == 67 && ctrl) { // Ctrl + C Pressed !
                	console.log('Ctrl + C Pressed !');
                } else if (key == 88 && ctrl) { //Ctrl + x Pressed
                	console.log('Ctrl + x Pressed!');
                } else if (key == 65 && ctrl) { //Ctrl + a Pressed !
                    console.log('Ctrl + a Pressed !');
                    
                } else if (key != 9 && e.which != 8 && e.which != 0 && !(e.keyCode >= 96 && e.keyCode <= 105) && !(e.keyCode >= 48 && e.keyCode <= 57)) {
                    return false;
                }
                var curchr = this.value.length;
                var curval = $(this).val();

                if (curchr == 0 && e.keyCode == 55) {
                	$(this).val('+' + curval);
                } else if (curchr == 0 && e.which != 8 && e.which != 0) {
                    $(this).val('+7 (' + curval);
                } else if (curchr == 2 && e.which != 8 && e.which != 0) {
                    $(this).val(curval + ' (');
                } else if (curchr == 7 && e.which != 8 && e.which != 0) {
                    $(this).val(curval + ')' + " ");
                } else if (curchr == 12 && e.which != 8 && e.which != 0) {
                    $(this).val(curval + "-");
                }

                $(this).attr('maxlength', '17');

            });
            $(this).bind('paste', function (e) {

                e.preventDefault();
                var inputValue = e.originalEvent && e.originalEvent.clipboardData.getData('Text');
                console.log(inputValue);
                inputValue = inputValue.replace(/\D/g, '');
                console.log(inputValue[0]);

                if (!$.isNumeric(inputValue)) {
                    return false;
                } else {
                	if (inputValue[0] == '8') {
                    	inputValue = inputValue.replace(/^[8]/g, '7');
                    }
                    if (inputValue[0] == '7') {
                    	if(inputValue.length > 10) {
                        	inputValue = String(inputValue.replace(/(\d{1})(\d{3})(\d{3})(\d{4})/, "+$1 ($2) $3-$4"));
                        } else if (inputValue.length > 7) {
                            inputValue = String(inputValue.replace(/(\d{1})(\d{3})(\d{3})(?=\d)/g, '+$1 ($2) $3-'));
                        } else if (inputValue.length > 3) {
                            inputValue = String(inputValue.replace(/(\d{1})(\d{3})/g, '+$1 ($2) '));
                        } else if (inputValue.length > 1) {
                            inputValue = String(inputValue.replace(/(\d{1})(\d{1,2})/g, '+$1 ($2'));
                        } else if (inputValue.length > 0) {
                            inputValue = String(inputValue.replace(/(\d{1})/g, '+$1 ('));
                        }
                    } else {
                    	if (inputValue.length > 10) {
                        	inputValue = String(inputValue.replace(/(\d{3})(\d{3})(\d{4})/, "+7 ($1) $2-$3"));
                        } else if (inputValue.length > 7) {
                            inputValue = String(inputValue.replace(/(\d{3})(\d{3})(?=\d)/g, '+7 ($1) $2-'));
                        } else if (inputValue.length > 5) {
                        	inputValue = String(inputValue.replace(/(\d{3})(?=\d)/g, '+7 ($1) '));
                        } else if (inputValue.length > 3) {
                            inputValue = String(inputValue.replace(/(\d{3})/g, '+7 ($1) '));
                        } else if (inputValue.length >= 1) {
                            inputValue = String(inputValue.replace(/(\d{1,3})/g, '+7 ($1'));
                        } else if (inputValue.length > 0) {
                            inputValue = String(inputValue.replace(/(\D)/g, '+7 ('));
                        }
                    }
                    $(this).val(inputValue);
                    $(this).val('');
                    inputValue = inputValue.substring(0, 17);
                    $(this).val(inputValue);
                }
            });

        }
        
    }
}(jQuery));